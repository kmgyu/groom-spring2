<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}">
<head>
    <title th:text="상품 관리">상품 관리</title>
</head>
<body>
<div layout:fragment="content" class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- 헤더 -->
    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900" th:text="${product.productSeq != null ? '상품수정' : '상품등록'}">상품 등록</h1>
        <p class="mt-2 text-sm text-gray-600" th:text="${product.productSeq != null ? '상품을 수정합니다.' : '새로운 상품을 등록합니다.'}">새로운 상품을 등록합니다.</p>
    </div>

    <!-- 에러 메시지 -->
    <div th:if="${errorMessage}" class="mb-6 p-4 bg-red-50 border border-red-200 rounded-md">
        <div class="text-red-800" th:text="${errorMessage}">오류 메시지</div>
    </div>

    <!-- 성공 메시지 -->
    <div th:if="${successMessage}" class="mb-6 p-4 bg-green-50 border border-green-200 rounded-md">
        <div class="text-green-800" th:text="${successMessage}">성공 메시지</div>
    </div>

    <!-- 상품 등록/수정 폼 -->
    <form th:action="${product.productSeq != null ? '/products/' + product.productSeq : '/products'}"
          method="post"
          th:object="${product}"
          enctype="multipart/form-data"
          class="space-y-8">

        <!-- 기본 정보 -->
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-medium text-gray-900 mb-6" th:text="#{product.form.basic.info}">기본 정보</h3>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- 상품명 -->
                <div class="md:col-span-2">
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-2">
                        <span th:text="#{product.form.name}">상품명</span> <span class="text-red-500" th:text="#{required}">*</span>
                    </label>
                    <input type="text" id="name" th:field="*{name}" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           th:classappend="${#fields.hasErrors('name')} ? 'border-red-300' : ''"
                           th:placeholder="#{product.placeholder.name}">
                    <div th:if="${#fields.hasErrors('name')}" class="mt-1 text-sm text-red-600" th:errors="*{name}">상품명 오류</div>
                </div>

                <!-- 상품 코드 -->
                <div>
                    <label for="code" class="block text-sm font-medium text-gray-700 mb-2">
                        <span th:text="#{product.form.code}">상품 코드</span> <span class="text-red-500" th:text="#{required}">*</span>
                    </label>
                    <input type="text" id="code" th:field="*{code}" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           th:classappend="${#fields.hasErrors('code')} ? 'border-red-300' : ''"
                           placeholder="PRD-001">
                    <div th:if="${#fields.hasErrors('code')}" class="mt-1 text-sm text-red-600" th:errors="*{code}">코드 오류</div>
                </div>

                <!-- SKU -->
                <div>
                    <label for="sku" class="block text-sm font-medium text-gray-700 mb-2">SKU</label>
                    <input type="text" id="sku" th:field="*{sku}"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="재고 관리 코드">
                </div>

                <!-- 카테고리 -->
                <div>
                    <label for="categorySeq" class="block text-sm font-medium text-gray-700 mb-2">카테고리</label>
                    <select id="categorySeq" th:field="*{categorySeq}"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">카테고리 선택</option>
                        <option th:each="category : ${categories}"
                                th:value="${category.categorySeq}"
                                th:text="${category.name}">카테고리명</option>
                    </select>
                </div>

                <!-- 공급업체 -->
                <div>
                    <label for="supplierSeq" class="block text-sm font-medium text-gray-700 mb-2">공급업체</label>
                    <select id="supplierSeq" th:field="*{supplierSeq}"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="">공급업체 선택</option>
                        <option th:each="supplier : ${suppliers}"
                                th:value="${supplier.supplierSeq}"
                                th:text="${supplier.name}">공급업체명</option>
                    </select>
                </div>

                <!-- 상품 설명 -->
                <div class="md:col-span-2">
                    <label for="description" class="block text-sm font-medium text-gray-700 mb-2">상품 설명</label>
                    <textarea id="description" th:field="*{description}" rows="4"
                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                              placeholder="상품에 대한 상세한 설명을 입력하세요"></textarea>
                </div>
            </div>
        </div>
        <!-- 가격 정보 -->
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-medium text-gray-900 mb-6">가격 정보</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- 판매가 -->
                <div>
                    <label for="unitPrice" class="block text-sm font-medium text-gray-700 mb-2">
                        판매가 <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <input type="number" id="unitPrice" th:field="*{unitPrice}" min="0" step="0.01" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                               th:classappend="${#fields.hasErrors('unitPrice')} ? 'border-red-300' : ''"
                               placeholder="0.00">
                        <span class="absolute right-3 top-2 text-gray-500">원</span>
                    </div>
                    <div th:if="${#fields.hasErrors('unitPrice')}" class="mt-1 text-sm text-red-600" th:errors="*{unitPrice}">가격 오류</div>
                </div>

                <!-- 원가 -->
                <div>
                    <label for="unitCost" class="block text-sm font-medium text-gray-700 mb-2">
                        원가 <span class="text-red-500">*</span>
                    </label>
                    <div class="relative">
                        <input type="number" id="unitCost" th:field="*{unitCost}" min="0" step="0.01" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                               th:classappend="${#fields.hasErrors('unitCost')} ? 'border-red-300' : ''"
                               placeholder="0.00">
                        <span class="absolute right-3 top-2 text-gray-500">원</span>
                    </div>
                    <div th:if="${#fields.hasErrors('unitCost')}" class="mt-1 text-sm text-red-600" th:errors="*{unitCost}">원가 오류</div>
                </div>
                <!-- 단위 -->
                <div>
                    <label for="unit" class="block text-sm font-medium text-gray-700 mb-2">단위</label>
                    <select id="unit" th:field="*{unit}"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option th:each="unitOption : ${T(io.goorm.board.enums.ProductUnit).values()}"
                                th:value="${unitOption}"
                                th:text="${unitOption.displayName}">개</option>
                    </select>
                </div>
                <!-- 상태 -->
                <div>
                    <label for="status" class="block text-sm font-medium text-gray-700 mb-2">상태</label>
                    <select id="status" th:field="*{status}"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option th:each="statusOption : ${T(io.goorm.board.enums.ProductStatus).values()}"
                                th:value="${statusOption}"
                                th:text="${statusOption.displayName}">판매중</option>
                    </select>
                </div>
            </div>
        </div>
        <!-- 추가 정보 -->
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-medium text-gray-900 mb-6">추가 정보</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- 바코드 -->
                <div>
                    <label for="barcode" class="block text-sm font-medium text-gray-700 mb-2">바코드</label>
                    <input type="text" id="barcode" th:field="*{barcode}"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="8801234567890">
                </div>

                <!-- 무게 -->
                <div>
                    <label for="weight" class="block text-sm font-medium text-gray-700 mb-2">무게 (kg)</label>
                    <input type="number" id="weight" th:field="*{weight}" min="0" step="0.001"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="0.000">
                </div>
                <!-- 크기 -->
                <div class="md:col-span-2">
                    <label for="dimensions" class="block text-sm font-medium text-gray-700 mb-2">크기 (가로 x 세로 x 높이)</label>
                    <input type="text" id="dimensions" th:field="*{dimensions}"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="예: 10cm x 5cm x 2cm">
                </div>
            </div>
        </div>
        <!-- 이미지 업로드 -->
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-medium text-gray-900 mb-6">상품 이미지</h3>
            <!-- 현재 이미지 (수정 시) -->
            <div th:if="${product.productSeq != null and product.currentImageUrl != null}" class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">현재 이미지</label>
                <div class="flex items-center space-x-4">
                    <img th:src="${product.currentImageUrl}" alt="현재 상품 이미지" class="w-24 h-24 object-cover rounded-lg border">
                    <div class="flex items-center">
                        <input type="checkbox" id="deleteImage" th:field="*{deleteImage}" class="mr-2">
                        <label for="deleteImage" class="text-sm text-red-600">이미지 삭제</label>
                    </div>
                </div>
            </div>
            <!-- 이미지 파일 선택 -->
            <div>
                <label for="imageFile" class="block text-sm font-medium text-gray-700 mb-2">
                    <span th:text="${product.productSeq != null  ? '새 이미지 선택' : '이미지 선택'}">이미지 선택</span>
                </label>
                <input type="file" id="imageFile" name="imageFile" accept="image/*"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <p class="mt-1 text-sm text-gray-500">JPG, PNG, GIF 파일을 지원합니다. (최대 10MB)</p>
            </div>
        </div>
        <!-- 버튼 -->
        <div class="flex justify-end space-x-4">
            <a th:href="@{/products}"
               class="px-6 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"
               th:text="#{product.action.cancel}">
                취소
            </a>
            <button type="submit"
                    class="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <span th:text="${product.productSeq != null ? '수정' : '등록'}">등록</span>
            </button>
        </div>
    </form>
</div>
</div>
</body>
</html>